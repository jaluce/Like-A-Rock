<script> 
$(document).ready(function(){
	var counter = 0;
	var mouseX = 0;
	var mouseY = 0;

    $("#imgtag img").click(function(e){ // make sure the image is click
      var imgtag = $(this).parent(); // get the div to append the tagging list
      mouseX = e.pageX - $(imgtag).offset().left; // x and y axis
      mouseY = e.pageY - $(imgtag).offset().top;
      $('#tagit').remove(); // remove any tagit div first
      $(imgtag).append('<div id="tagit"><div class="box"></div><input type="button" name="btnsave" value="Save" id="btnsave" /><input type="button" name="btncancel" value="Cancel" id="btncancel" /></div></div>');
      $('#tagit').css({top:mouseY,left:mouseX});

      $('#tagname').focus();
  });

    $('#tagit #btnsave').live('click',function(){
    	name = $('#tagname').val();

    	$.ajax({
    		type: "POST", 
    		url: <%= @image.id %> + "/newtag",
    		data: {x: mouseX, y: mouseY},
    		cache: true,
    		success: function(data){
    			viewtag();
    			$('#tagit').fadeOut();
    		}
    	});
    	return false;
    });

    $('#tagit #btncancel').live('click',function(){
    	$('#tagit').fadeOut();
    	return false;
    });

    $('#taglist li').live('mouseover mouseout',function(event){
    	id = $(this).attr("rel");
    	if (event.type == "mouseover"){
    		$('#view_' + id).show();
    	}else{
    		$('#view_' + id).hide();
    	}
    	return false;
    });

    $('#taglist li a.remove').live('click',function(){
    	id = $(this).parent().attr("rel");
      // get all tag on page load
      $.ajax({
      	type: "POST", 
      	url: $(this).href, 
      	data: "tag_id=" + id,
      	success: function(data){
      		viewtag();
      	}
      });
      return false;
  });

    viewtag(); // get all tag on page load

    function viewtag(pic_id)
    {
      // get the tag list with action remove
      $.ajax({
      	type: "POST", 
      	url: <%= @image.id %> + "/tags" , 
      	data: {},
      	cache: true, 
      	success: function(data){
      		$('#taglist ol').html(data);
      	}
      });

      // get the tag list for boxes
      $.ajax({
      	type: "POST", 
      	url: <%= @image.id %>,  
      	data: {},
      	cache: true, 
      	success: function(data){
      		$('#tagbox').html(data);
      	}
      });
  }
  return false;
});
</script> 
<div id="adminImagePage" class="imagePage">
	<div class="imageStuff"> 
		<div id="imgtag"> 
			<%= image_tag(@image.urlList, :size => "980x500")%>
			<div id="tagbox"></div>
		</div>
		<div class="adminImageInfo">
			<%if @image == @first %>
				<a href="<%= album_image_path(@album, @last) %>">Previous</a> | <a href="<%= album_image_path(@album, @next)%>">Next</a>
			<%elsif @last == @image %>
				<a href="<%= album_image_path(@album, @prev) %>">Previous</a> | <a href="<%= album_image_path(@album, @first)%>">Next</a>
			<%else%>
				<a href="<%= album_image_path(@album, @prev) %>">Previous</a> | <a href="<%= album_image_path(@album, @next)%>">Next</a>
			<%end%>
			<p>
				<b>Score:</b>
				<%= @votes.count%>
			</p>
		</br>
		<h2>Questions:</h2>
		<%if @comments.empty?%>
		<p>There are no Questions for this image.</p>
		<%else%>
		<%@comments.each do |comment|%>
		<p>Comment from <%= comment.user.name%>: <%= comment.body%></p>
		<%end%>
		<%end%>
	</div>
</div>
<div class="adminResponse">	
	<%= form_for(@newresponse, remote: true) do |f| %>

	<div class="newsTickerTitle">Respond</div>
	<div class="IndentResponse">
		<%= f.label "Video URL" %><br />
		<%= f.text_area :url, :size => "100x1"%>
	</br>
	<div><%= f.label "Text Response" %><br />
		<%= f.text_area :body, :size => "100x10"%></div>
		<%= f.hidden_field :image_id, :value => @image.id %>
		<%= f.hidden_field :admin_id, :value => current_admin.id%>


		<%= f.submit "Respond" %>
	</br>		
</br>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<a href="https://www.facebook.com/dialog/feed?app_id=329186050540125&redirect_uri=http://www.Askcuriosity.com" target="_blank"><img src="/assets/fbookShare.jpg" border="2" alt="El libro de cara" height = "33px" /></a>
<a href="https://twitter.com/intent/tweet?button_hashtag=Like-a-Rock&text=%40NASAJPL%20%40MarsCuriosity%20%23Like-a-Rock%20The%20Curiosity%20Rover%20is%20really%20cool!%20Come%20check%20it%20out%20at%20AskCuriosity.com" class="twitter-hashtag-button" data-related="MarsCuriosity,NASAJPL" data-url="http://askcuriosity.com">Tweet #Like-a-Rock</a>				
<%end%>
</br>
</div>
<h2 class="newsTickerTitle">Previous Responses:</h2>
<ul class="IndentResponse" id="adminresp">
	<%= render 'responses/response'%>
</ul>
</div>
</div>